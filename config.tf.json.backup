{
  "data": {
    "oci_core_images": {
      "ubuntu-20-04": {
        "compartment_id": "${data.sops_file.oci.data[\"oci.tenancy\"]}",
        "filter": {
          "name": "display_name",
          "regex": true,
          "values": [
            "^Canonical-Ubuntu-20.04-([\\.0-9-]+)$"
          ]
        },
        "operating_system": "Canonical Ubuntu"
      }
    },
    "oci_core_subnet": {
      "default_sub": {
        "subnet_id": "ocid1.subnet.oc1.eu-milan-1.aaaaaaaacc3ifofytrjoy4ajyc2c6nwr3iuyl7yk4fqxabemaedryw67zlzq"
      }
    },
    "oci_identity_availability_domain": {
      "ad": {
        "ad_number": 1,
        "compartment_id": "${data.sops_file.oci.data[\"oci.tenancy\"]}"
      }
    },
    "sops_file": {
      "oci": {
        "source_file": "oci_secrets.yaml"
      },
      "openstack": {
        "source_file": "openstack_secrets.yaml"
      }
    }
  },
  "output": {
    "axel_ipv4_address": {
      "value": "${ openstack_compute_instance_v2.axel.access_ip_v4 }"
    },
    "axel_ipv6_address": {
      "value": "${ openstack_compute_instance_v2.axel.access_ip_v6 }"
    },
    "kelpie_ipv4_address": {
      "value": "${ openstack_compute_instance_v2.kelpie.access_ip_v4 }"
    },
    "kelpie_ipv6_address": {
      "value": "${ openstack_compute_instance_v2.kelpie.access_ip_v6 }"
    }
  },
  "provider": {
    "oci": {
      "private_key": "${data.sops_file.oci.data[\"oci.private_key\"]}",
      "region": "eu-milan-1",
      "tenancy_ocid": "${data.sops_file.oci.data[\"oci.tenancy\"]}",
      "user_ocid": "${data.sops_file.oci.data[\"oci.user\"]}"
    },
    "openstack": {
      "application_credential_id": "${data.sops_file.openstack.data[\"openstack.app_id\"]}",
      "application_credential_secret": "${data.sops_file.openstack.data[\"openstack.sec_id\"]}",
      "auth_url": "https://keystone.cloud.garr.it:5000/v3",
      "region": "garr-pa1"
    }
  },
  "resource": {
    "local_file": {
      "openstack_export_nix": {
        "content": "# generated by terranix-openstack : openstack.export.nix\n# it lists every return value created\n# by the openstack provider in nix format\n# so you can import it in another nix-lang tool\n{\n\n\n# openstack servers:\naxel = {\n  host = {\n    ipv4 = \"${ openstack_compute_instance_v2.axel.access_ip_v4 }\";\n    ipv6 = \"${ openstack_compute_instance_v2.axel.access_ip_v6 }\";\n    ipv4-floating = \"${ openstack_networking_floatingip_v2.axel-fip.fixed_ip }\";\n  };\n  location = \"${ openstack_compute_instance_v2.axel.region}\";\n};\n\nkelpie = {\n  host = {\n    ipv4 = \"${ openstack_compute_instance_v2.kelpie.access_ip_v4 }\";\n    ipv6 = \"${ openstack_compute_instance_v2.kelpie.access_ip_v6 }\";\n    ipv4-floating = \"${ openstack_networking_floatingip_v2.kelpie-fip.fixed_ip }\";\n  };\n  location = \"${ openstack_compute_instance_v2.kelpie.region}\";\n};\n\n}\n",
        "filename": "./nixos/machines/nixos-machines.nix"
      }
    },
    "oci_core_instance": {
      "free_instance_AMD0": {
        "availability_domain": "${data.oci_identity_availability_domain.ad.name}",
        "compartment_id": "${data.sops_file.oci.data[\"oci.tenancy\"]}",
        "create_vnic_details": {
          "assign_public_ip": true,
          "display_name": "primaryvnic",
          "hostname_label": "freeinstance0",
          "subnet_id": "${data.oci_core_subnet.default_sub.id}"
        },
        "display_name": "freeInstance0",
        "metadata": {
          "ssh_authorized_keys": "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILCmIz2Selg5eJ77lvpJHgDJiRIOZbucMjDK5zrhTEWK heph@fenrir",
          "user_data": "${base64encode(file(\"./boot.sh\"))}"
        },
        "shape": "VM.Standard.E2.1.Micro",
        "source_details": {
          "source_id": "ocid1.image.oc1.eu-milan-1.aaaaaaaakv4wkaruajtxpwoben4terryml4lr3wtnpb5hz74mawsexsge2wa",
          "source_type": "image"
        }
      }
    },
    "openstack_compute_floatingip_associate_v2": {
      "axel-fip-associate": {
        "floating_ip": "${ openstack_networking_floatingip_v2.axel-fip.address }",
        "instance_id": "${ openstack_compute_instance_v2.axel.id }"
      },
      "kelpie-fip-associate": {
        "floating_ip": "${ openstack_networking_floatingip_v2.kelpie-fip.address }",
        "instance_id": "${ openstack_compute_instance_v2.kelpie.id }"
      }
    },
    "openstack_compute_instance_v2": {
      "axel": {
        "flavor_name": "m1.medium",
        "image_name": "NixOS 21 11",
        "name": "axel",
        "network": [
          {
            "port": "${openstack_networking_port_v2.axel-port.id}"
          }
        ]
      },
      "kelpie": {
        "flavor_name": "m1.medium",
        "image_name": "NixOS 21 11",
        "name": "kelpie",
        "network": [
          {
            "port": "${openstack_networking_port_v2.kelpie-port.id}"
          }
        ]
      }
    },
    "openstack_compute_keypair_v2": {
      "server_pek": {
        "name": "SSH Key pek",
        "public_key": "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILCmIz2Selg5eJ77lvpJHgDJiRIOZbucMjDK5zrhTEWK heph@fenrir"
      }
    },
    "openstack_networking_floatingip_v2": {
      "axel-fip": {
        "pool": "floating-ip"
      },
      "kelpie-fip": {
        "pool": "floating-ip"
      }
    },
    "openstack_networking_port_v2": {
      "axel-port": {
        "name": "axel-port",
        "network_id": "fe0de0e1-cf81-4d6f-b1f1-f1ecc42d07bb",
        "security_group_ids": [
          "c5e4d2ed-6f5b-4efe-831f-5ae93010fe4a"
        ]
      },
      "kelpie-port": {
        "name": "kelpie-port",
        "network_id": "fe0de0e1-cf81-4d6f-b1f1-f1ecc42d07bb",
        "security_group_ids": [
          "c5e4d2ed-6f5b-4efe-831f-5ae93010fe4a"
        ]
      }
    }
  },
  "terraform": {
    "required_providers": {
      "oci": {
        "source": "oracle/oci"
      },
      "openstack": {
        "source": "terraform-provider-openstack/openstack"
      },
      "sops": {
        "source": "carlpett/sops"
      }
    }
  }
}
